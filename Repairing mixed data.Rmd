---
title: "R Notebook"
output: html_notebook
---
```{r Importing libraries}
library(dplyr)
library(tidyr)
library(zoo)
```
```{r Load Datasets}
left_df_1 <- read.csv(".\\OpenPose\\S4\\left_dataframe.csv")
right_df_1 <- read.csv(".\\OpenPose\\S4\\right_dataframe.csv")
```
Let's move the values where the boys don't line up using the nose keypoint, since that one doesn't move too much in the x direction

First isolate the x coordinate of the nose across frames
```{r}
x_Nose_left <- left_df_1$Nose
x_Nose_left <- as.numeric(gsub(".*[(]([^,]+)[,].*", "\\1", x_Nose_left))
#Missing Data
mean(complete.cases(x_Nose_left))
na.locf(x_Nose_left)
index<- 1:length(x_Nose_left)
plot(index, x_Nose_left)
left_df_1$x_Nose_left <- x_Nose_left
```
```{r}
affected_rows<- subset(left_df_1, left_df_1$x_Nose_left > 700)
temp <- right_df_1
temp[temp$X %in% affected_rows$X, ] <- affected_rows
```
Take a random coordinate to isolate, let's say the Left Wrist's y value
```{r}
y_LW_right <- temp$LWrist
y_LW_right <- as.numeric(gsub(".*[ ]([^,]+)[)].*", "\\1", y_LW_right))
#Missing Data
mean(complete.cases(y_LW_right))
na.locf(y_LW_right)
y_LW_right <- 720-y_LW_right
index<- 1:length(y_LW_right)
plot(index, y_LW_right)
```

And they're all in a realistic range, now let's look at the video to see what happens.
At the end of the video, the person on the right adjusts his microphone stand by raising and then lowering his wrist. It's a clear match!

Now replicate and theck for the same wrist of the left person
```{r}
index_rtl = affected_rows$X 
affected_rowsrtl<- subset(right_df_1, right_df_1$X %in% index_rtl)
left_df_1[left_df_1$X %in% affected_rowsrtl$X, ] <- affected_rowsrtl
```

```{r}
y_LW_left <- left_df_1$LWrist
y_LW_left <- as.numeric(gsub(".*[ ]([^,]+)[)].*", "\\1", y_LW_left))
#Missing Data
mean(complete.cases(y_LW_left))
na.locf(y_LW_left)
y_LW_left <- 720-y_LW_left

plot(index, y_LW_left)
```
The person on the left points and puts his wrist back down, another match!
Now we can turn temp into the right_df_1 and save over the original csv files
```{r}
right_df_1 <- temp
write.csv(right_df_1,"C:\\Users\\harol\\Desktop\\TrashTasteProject\\OpenPose\\S4\\right_dataframe.csv", row.names = TRUE)
write.csv(left_df_1,"C:\\Users\\harol\\Desktop\\TrashTasteProject\\OpenPose\\S4\\left_dataframe.csv", row.names = TRUE)
```